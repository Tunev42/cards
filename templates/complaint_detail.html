{% extends "base.html" %}

{% block content %}
<div class="container">
    <div class="complaint-detail">
        <a href="{{ url_for('index') }}" class="back-link">
            <i class="fas fa-arrow-left"></i> Назад к списку
        </a>

        <div class="complaint-card">
            <div class="complaint-header">
                <span class="complaint-category">{{ complaint.category }}</span>
                <span class="complaint-status {{ complaint.status|lower|replace(' ', '-') }}">
                    {{ complaint.status }}
                </span>
                <span class="complaint-date">
                    {{ complaint.created_at.strftime('%d.%m.%Y %H:%M') }}
                </span>
            </div>

            <h1 class="complaint-title">{{ complaint.title }}</h1>

            <p class="complaint-description">{{ complaint.description }}</p>

            {% if complaint.address %}
            <p class="complaint-address">
                <i class="fas fa-map-marker-alt"></i> {{ complaint.address }}
            </p>
            {% endif %}

            {% if complaint.photo %}
            <div class="complaint-photo-detail">
                <img src="{{ url_for('static', filename='uploads/' + complaint.photo) }}"
                     alt="Фото проблемы">
            </div>
            {% endif %}

            <div class="complaint-stats">
                <div class="stat">
                    <i class="fas fa-thumbs-up"></i>
                    <span class="stat-value">{{ complaint.votes }}</span>
                    <span class="stat-label">поддержали</span>
                </div>

                {% if complaint.author %}
                <div class="stat">
                    <i class="fas fa-user"></i>
                    <span class="stat-value">{{ complaint.author.username }}</span>
                    <span class="stat-label">автор</span>
                </div>
                {% endif %}
            </div>

            <button class="vote-btn-detail" onclick="vote({{ complaint.id }})">
                <i class="fas fa-thumbs-up"></i> Поддержать эту жалобу
                <span class="vote-count" id="votes-{{ complaint.id }}">{{ complaint.votes }}</span>
            </button>
        </div>
    </div>
</div>

<script>
function vote(complaintId) {
    fetch('/vote/' + complaintId, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            const voteCount = document.getElementById('votes-' + complaintId);
            voteCount.textContent = data.new_count;

            // Анимация
            const btn = voteCount.closest('.vote-btn-detail');
            btn.style.backgroundColor = '#2ecc71';
            setTimeout(() => {
                btn.style.backgroundColor = '';
            }, 500);
        } else {
            alert(data.message || 'Ошибка голосования');
        }
    });
}
</script>
{% endblock %}
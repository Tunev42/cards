{% extends "base.html" %}

{% block content %}
<div class="container">
    <div class="complaint-detail">
        <a href="{{ url_for('index') }}" class="back-link">
            <i class="fas fa-arrow-left"></i> Назад к списку
        </a>

        <div class="complaint-card detailed">
            <!-- Категория и статус -->
            <div class="detail-header">
                <div class="detail-category"
                     style="background-color: {{ complaint.complaint_category.color }}20;
                            color: {{ complaint.complaint_category.color }};
                            border-left: 6px solid {{ complaint.complaint_category.color }}">
                    <i class="{{ complaint.complaint_category.icon }}"></i>
                    <h3>{{ complaint.complaint_category.name }}</h3>
                    <p>{{ complaint.complaint_category.description }}</p>
                </div>

                <div class="detail-status"
                     style="background-color: {{ complaint.complaint_status.color }}20;
                            color: {{ complaint.complaint_status.color }};
                            border: 2px solid {{ complaint.complaint_status.color }}">
                    <i class="{{ complaint.complaint_status.icon }}"></i>
                    <h3>{{ complaint.complaint_status.name }}</h3>
                    <p>{{ complaint.complaint_status.description }}</p>
                </div>
            </div>

            <!-- Заголовок -->
            <h1 class="detail-title">{{ complaint.title }}</h1>

            <!-- Описание -->
            <div class="detail-description">
                <h3><i class="fas fa-align-left"></i> Описание проблемы</h3>
                <p>{{ complaint.description }}</p>
            </div>

            <!-- Адрес -->
            {% if complaint.address %}
            <div class="detail-address">
                <h3><i class="fas fa-map-marker-alt"></i> Адрес</h3>
                <p>{{ complaint.address }}</p>
            </div>
            {% endif %}

            <!-- Дополнительная информация -->
            <div class="detail-info">
                <div class="info-item">
                    <i class="fas fa-user"></i>
                    <div>
                        <strong>Автор</strong>
                        <p>{{ complaint.author.username if complaint.author else 'Аноним' }}</p>
                    </div>
                </div>

                <div class="info-item">
                    <i class="fas fa-calendar-plus"></i>
                    <div>
                        <strong>Создано</strong>
                        <p>{{ complaint.created_at.strftime('%d.%m.%Y %H:%M') }}</p>
                    </div>
                </div>

                <div class="info-item">
                    <i class="fas fa-sync-alt"></i>
                    <div>
                        <strong>Обновлено</strong>
                        <p>{{ complaint.updated_at.strftime('%d.%m.%Y %H:%M') }}</p>
                    </div>
                </div>

                <div class="info-item">
                    <i class="fas fa-thumbs-up"></i>
                    <div>
                        <strong>Поддержали</strong>
                        <p id="votes-{{ complaint.id }}">{{ complaint.votes }} человек</p>
                    </div>
                </div>
            </div>

            <!-- Фото -->
            {% if complaint.photo %}
            <div class="detail-photo">
                <h3><i class="fas fa-camera"></i> Фотография проблемы</h3>
                <img src="{{ url_for('static', filename='uploads/' + complaint.photo) }}"
                     alt="Фото проблемы">
            </div>
            {% endif %}

            <!-- Действия -->
            <div class="detail-actions">
                <button class="vote-btn-large" onclick="vote({{ complaint.id }})">
                    <i class="fas fa-thumbs-up"></i> Поддержать эту проблему
                    <span class="vote-count-large">{{ complaint.votes }}</span>
                </button>

                <div class="share-actions">
                    <button class="share-btn" onclick="shareComplaint()">
                        <i class="fas fa-share-alt"></i> Поделиться
                    </button>
                    <button class="bookmark-btn" onclick="bookmarkComplaint()">
                        <i class="far fa-bookmark"></i> В закладки
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function vote(complaintId) {
    fetch('/vote/' + complaintId, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            const voteCount = document.getElementById('votes-' + complaintId);
            voteCount.textContent = data.new_count + ' человек';

            // Анимация
            const btn = document.querySelector('.vote-btn-large');
            btn.style.backgroundColor = '#2ecc71';
            setTimeout(() => {
                btn.style.backgroundColor = '';
            }, 500);
        }
    });
}
</script>
{% endblock %}